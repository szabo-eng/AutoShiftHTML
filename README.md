# 📅 מערכת שיבוץ מבצעית 2026

מערכת מתקדמת לניהול שיבוץ משמרות עם אלגור הגנות חכם, תמיכה ב-Firebase ומגבלות שבועיות.

## ✨ תכונות עיקריות

### 🪄 שיבוץ חכם
- **שיבוץ אוטומטי** עם אלגוריתם הוגנות מבוסס מאזן
- **שיבוץ ידני** עם גמישות מלאה
- **התאמת שעות מדויקת** - ווידוא שעובדים זמינים בשעות הנדרשות
- **מגבלת שיבוץ שבועית** - מניעת עומס יתר

### ⚖️ הוגנות ושקיפות
- **מאזן משמרות** - עקיבה אחר כמות המשמרות של כל עובד
- **עדיפות למאזן נמוך** - עובדים שעבדו פחות מקבלים עדיפות
- **מעקב שבועי** - מגבלה על מספר משמרות לשבוע
- **היסטוריה מלאה** - שמירת כל השיבוצים ב-Database

### 🔒 בטיחות ותקינה
- **אימות אט"ן** - רק עובדים מורשים למשמרות אט"ן
- **מניעת כפילויות** - עובד לא יעבוד יותר ממשמרת אחת ביום
- **ולידציה** - בדיקת תקינות קבצים לפני עיבוד

### 📊 דוחות וניתוח
- **דוח חוסרים מפורט** - זיהוי משמרות שלא שובצו + סיבה
- **ייצוא CSV מלא** - כל הפרטים: תאריך, שעות, תחנה, עובד, מאזן
- **סטטיסטיקות בזמן אמת** - סה"כ משמרות, משובצות, חסרות

### 💾 שמירה ל-Firebase
- **שמירת משמרות** - כל משמרת עם כל הפרטים
- **היסטוריית עובדים** - רשימת כל התאריכים + מאזן מצטבר
- **משמרות מבוטלות** - מעקב גם אחרי ביטולים

## 🚀 התקנה מהירה

### 1. Clone הפרויקט
```bash
git clone https://github.com/your-username/shift-scheduler.git
cd shift-scheduler
```

### 2. התקן תלויות
```bash
pip install -r requirements.txt
```

### 3. הגדר Firebase (אופציונלי)
צור קובץ `.streamlit/secrets.toml`:
```toml
[firebase]
type = "service_account"
project_id = "your-project-id"
private_key_id = "..."
private_key = "..."
client_email = "..."
client_id = "..."
auth_uri = "https://accounts.google.com/o/oauth2/auth"
token_uri = "https://oauth2.googleapis.com/token"
```

### 4. הרץ
```bash
streamlit run app_modular.py
```

## 📁 פורמט קבצים

### קובץ בקשות עובדים (CSV)
```csv
שם,תאריך מבוקש,משמרת,תחנה,שעות,אט"ן
יוסי כהן,15/02/2026,בוקר,תחנה א,08:00-16:00,כן
דוד לוי,16/02/2026,ערב,תחנה ב,16:00-00:00,לא
מרים כהן,17/02/2026,לילה,תחנה א,00:00-08:00,כן
```

**עמודות חובה:**
- `שם` - שם העובד
- `תאריך מבוקש` - פורמט: DD/MM/YYYY
- `משמרת` - בוקר/ערב/לילה
- `תחנה` - שם התחנה

**עמודות אופציונליות:**
- `שעות` - שעות עבודה (לבדיקת התאמה)
- `אט"ן` - כן/לא (להרשאות)

### קובץ תבנית משמרות (CSV)
```csv
תחנה,משמרת,סוג תקן,שעות
תחנה א,בוקר,רגיל,08:00-16:00
תחנה א,ערב,רגיל,16:00-00:00
תחנה ב,בוקר,אט"ן,08:00-16:00
תחנה ב,לילה,אט"ן,00:00-08:00
```

**עמודות חובה:**
- `תחנה` - שם התחנה
- `משמרת` - סוג משמרת
- `סוג תקן` - רגיל/אט"ן

**עמודות אופציונליות:**
- `שעות` - שעות המשמרת

## ⚙️ הגדרות מערכת

### בדיקת שעות מדויקת
- ✅ מסומן: רק עובדים ששעותיהם תואמות בדיוק ישובצו
- ☐ לא מסומן: התעלמות משעות

### מכסה שבועית
- ברירת מחדל: 5 משמרות לשבוע
- טווח: 1-7 משמרות
- מונע עומס יתר על עובדים

## 🎯 כללי שיבוץ

### שיבוץ אוטומטי:
1. ✅ העובד ביקש את התאריך
2. ✅ העובד ביקש את המשמרת
3. ✅ העובד ביקש את התחנה
4. ✅ העובד ביקש את השעות (אם מופעל)
5. ✅ העובד לא עובד היום
6. ✅ העובד לא עבר מכסה שבועית
7. ✅ העובד מורשה אט"ן (אם נדרש)
8. ✅ לעובד המאזן הנמוך ביותר

### שיבוץ ידני:
- גמישות: ניתן לשבץ לתחנה אחרת מהמבוקשת
- מגבלה: לא ניתן לשבץ עובד שכבר עובד היום
- אזהרה: התראה כשמשבצים לתחנה שונה

## 📊 ייצוא נתונים

הקובץ המיוצא כולל:

| עמודה | תיאור |
|-------|--------|
| תאריך | תאריך המשמרת |
| יום | יום בשבוע |
| שעות | שעות עבודה |
| משמרת | סוג משמרת |
| תחנה משובצת | התחנה בפועל |
| תחנה מבוקשת | מה העובד ביקש |
| סוג תקן | רגיל/אט"ן |
| שם עובד | שם העובד |
| מאזן משמרות | כמה משמרות עבד |
| סטטוס | משובץ/מבוטל |

## 🐛 פתרון בעיות

### הש יבוץ לא עובד:
1. בדוק שיש עמודת "שעות" בשני הקבצים
2. ודא שהפורמט זהה (08:00-16:00)
3. נסה לכבות "בדיקת שעות מדויקת"

### Firebase לא מתחבר:
1. ודא ש-secrets.toml קיים ב-.streamlit/
2. בדוק שכל השדות נכונים
3. ודא ש-Firestore מופעל בקונסול

### דוח חוסרים מלא:
- "אין בקשות" - אף עובד לא ביקש
- "כל המבקשים משובצים" - כולם עובדים היום
- "אין התאמה לשעות" - שעות לא תואמות
- "כולם עברו מכסה שבועית" - כולם עבדו מספיק
- "אין מורשי אט"ן" - אין עובדים עם הרשאה

## 📖 תיעוד נוסף

ראה קבצים:
- `DATABASE_STRUCTURE.md` - מבנה Firebase
- `FIREBASE_SETUP.md` - הדרכת הגדרה

## 📝 רישיון

MIT License - ראה קובץ LICENSE

## 🤝 תרומה

Pull requests מתקבלים בברכה!

## 📧 יצירת קשר

לשאלות או בעיות, פתח Issue ב-GitHub.
